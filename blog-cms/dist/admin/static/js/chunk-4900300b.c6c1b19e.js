(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4900300b"],{"05a7":function(t,e,a){},"3ae7":function(t,e,a){"use strict";a("05a7")},"64c0":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-row",[a("el-select",{staticStyle:{"min-width":"200px"},attrs:{disabled:""},model:{value:t.upyunConfig.bucketName,callback:function(e){t.$set(t.upyunConfig,"bucketName",e)},expression:"upyunConfig.bucketName"}}),a("el-cascader",{staticStyle:{"min-width":"450px"},attrs:{placeholder:"请选择目录",options:t.pathArr,props:t.pathProps},model:{value:t.activePath,callback:function(e){t.activePath=e},expression:"activePath"}}),a("el-button",{attrs:{type:"primary",size:"medium",icon:"el-icon-search"},on:{click:t.search}},[t._v("查询")]),a("el-button",{staticClass:"right-item",attrs:{type:"primary",size:"medium",icon:"el-icon-upload"},on:{click:function(e){t.isDrawerShow=!t.isDrawerShow}}},[t._v("上传")])],1),t.hintShow1?a("el-alert",{attrs:{title:"只显示<img>标签支持的 apng,avif,bmp,gif,ico,cur,jpg,jpeg,jfif,pjpeg,pjp,png,svg,tif,tiff,webp 格式的图片，见 https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/img",type:"warning","show-icon":"","close-text":"不再提示"},on:{close:function(e){return t.noDisplay(1)}}}):t._e(),t.hintShow2?a("el-alert",{attrs:{title:"最多显示100个文件",type:"warning","show-icon":"","close-text":"不再提示"},on:{close:function(e){return t.noDisplay(2)}}}):t._e(),a("el-row",{directives:[{name:"viewer",rawName:"v-viewer"}]},t._l(t.fileList,(function(e,i){return a("div",{key:i,staticClass:"image-container"},[a("el-image",{attrs:{src:e.cdn_url,fit:"scale-down"}}),a("div",{staticClass:"image-content"},[a("div",{staticClass:"info"},[a("span",[t._v(t._s(e.name))])]),a("div",{staticClass:"icons"},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"复制CDN链接",placement:"bottom"}},[a("i",{staticClass:"icon el-icon-link",on:{click:function(a){return t.copy(1,e)}}})]),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"复制MD格式",placement:"bottom"}},[a("SvgIcon",{attrs:{"icon-class":"markdown","class-name":"icon"},on:{click:function(a){return t.copy(2,e)}}})],1),a("i",{staticClass:"icon el-icon-delete",on:{click:function(a){return t.delFile(e)}}})],1)])],1)})),0),a("el-drawer",{attrs:{title:"上传文件",visible:t.isDrawerShow,direction:"rtl",size:"40%",wrapperClosable:!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.isDrawerShow=e}}},[a("el-row",[a("el-radio",{attrs:{label:"1"},model:{value:t.nameType,callback:function(e){t.nameType=e},expression:"nameType"}},[t._v("使用源文件名")]),a("el-radio",{attrs:{label:"2"},model:{value:t.nameType,callback:function(e){t.nameType=e},expression:"nameType"}},[t._v("使用UUID文件名")]),a("el-button",{directives:[{name:"throttle",rawName:"v-throttle",value:[t.submitUpload,"click",3e3],expression:"[submitUpload,`click`,3000]"}],attrs:{size:"small",type:"primary",icon:"el-icon-upload"}},[t._v("确定上传")])],1),a("el-row",[t._v(" 当前目录："+t._s(t.realPath)+" ")]),a("el-row",[a("el-switch",{attrs:{"active-text":"自定义目录"},model:{value:t.isCustomPath,callback:function(e){t.isCustomPath=e},expression:"isCustomPath"}}),a("el-input",{staticStyle:{"margin-top":"10px"},attrs:{placeholder:"例：oldFolder/newFolder/",disabled:!t.isCustomPath,size:"medium"},model:{value:t.customPath,callback:function(e){t.customPath=e},expression:"customPath"}})],1),a("el-upload",{ref:"uploadRef",attrs:{action:"","http-request":t.upload,drag:"",multiple:"","file-list":t.uploadList,"list-type":"picture","auto-upload":!1}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text"},[t._v("将文件拖到此处，或"),a("em",[t._v("点击上传")])])])],1)],1)},s=[],n=a("c00a"),o=a("bc3a"),c=a.n(o),l=a("323e"),r=a.n(l),u=(a("a5d8"),a("5c96"));const p=c.a.create({baseURL:"https://v0.api.upyun.com",timeout:3e4});function h(t,e){return e=e.startsWith("/")?e:"/"+e,p({url:`/${t}${e}`,method:"GET"})}function m(t,e){return p({url:`/${t}${e}`,method:"DELETE"})}function d(t,e,a,i){return e=e.startsWith("/")?e:"/"+e,e=e.endsWith("/")?e:e+"/",p({url:`/${t}${e}${a}`,method:"PUT",data:i})}p.interceptors.request.use(t=>{r.a.start(),t.headers["Accept"]="application/json";const e=localStorage.getItem("upyunToken");return e&&(t.headers["Authorization"]="Basic "+e),t},t=>(console.info(t),Promise.reject(t))),p.interceptors.response.use(t=>(r.a.done(),t.data),t=>(console.info(t),u["Message"].error(t.message),Promise.reject(t)));var f=a("c54a"),g=a("f988"),y=a("f43e"),v={name:"UpyunManage",components:{SvgIcon:n["a"]},data(){return{upyunConfig:{username:"",password:"",bucketName:"",domain:""},pathArr:[{value:"",label:"根目录"}],activePath:[""],pathProps:{lazy:!0,checkStrictly:!0,lazyLoad:async(t,e)=>{let a=t.path.join("/"),i=[];await this.getReposContents(i,a),e(i)}},hintShow1:!0,hintShow2:!0,fileList:[],isDrawerShow:!1,nameType:"1",uploadList:[],isCustomPath:!1,customPath:""}},computed:{realPath(){return this.isCustomPath?"/"+this.customPath:this.activePath.join("/")+"/"}},created(){this.hintShow1=!localStorage.getItem("upyunHintShow1"),this.hintShow2=!localStorage.getItem("upyunHintShow2");const t=localStorage.getItem("upyunConfig");t?this.upyunConfig=JSON.parse(t):(this.msgError("请先配置又拍云"),this.$router.push("/pictureHosting/setting"))},methods:{async getReposContents(t,e){await h(this.upyunConfig.bucketName,e).then(e=>{e.files.forEach(e=>{"folder"===e.type&&t.push({value:e.name,label:e.name,leaf:!1})})})},search(){this.fileList=[];let t=this.activePath.join("/");h(this.upyunConfig.bucketName,t).then(t=>{t.files.forEach(t=>{"folder"!==t.type&&Object(f["b"])(t.name)&&(t.path=this.imgPath(t),t.cdn_url=this.imgCdnUrl(t),this.fileList.push(t))})})},noDisplay(t){localStorage.setItem("upyunHintShow"+t,"1")},imgPath(t){let e=this.activePath.join("/");return e=e.startsWith("/")?e:"/"+e,e=e.endsWith("/")?e:e+"/",`${e}${t.name}`},imgCdnUrl(t){return`${this.upyunConfig.domain}${this.imgPath(t)}`},copy(t,e){let a="";1==t?a=e.cdn_url:2==t&&(a=`![${e.name}](${e.cdn_url})`),Object(y["a"])(a),this.msgSuccess("复制成功")},delFile(t){this.$confirm("此操作将永久删除该文件, 是否删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{m(this.upyunConfig.bucketName,t.path).then(()=>{this.msgSuccess("删除成功"),this.search()})}).catch(()=>{this.$message({type:"info",message:"已取消删除"})})},submitUpload(){this.uploadList=this.$refs.uploadRef.uploadFiles,this.uploadList.length?this.$refs.uploadRef.submit():this.msgError("请先选择文件")},upload(t){let e=t.file.name;"2"===this.nameType&&(e=Object(g["a"])()+e.substr(e.lastIndexOf("."))),d(this.upyunConfig.bucketName,this.realPath,e,t.file).then(()=>{this.msgSuccess("上传成功"),t.onSuccess()})}}},w=v,x=(a("3ae7"),a("991b"),a("2877")),b=Object(x["a"])(w,i,s,!1,null,"9a1f671a",null);e["default"]=b.exports},"991b":function(t,e,a){"use strict";a("dc7e")},dc7e:function(t,e,a){},f43e:function(t,e,a){"use strict";function i(t){let e=document.createElement("input");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("Copy"),e.remove()}a.d(e,"a",(function(){return i}))},f988:function(t,e,a){"use strict";function i(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){let e=16*Math.random()|0,a="x"==t?e:3&e|8;return a.toString(16)}))}a.d(e,"a",(function(){return i}))}}]);